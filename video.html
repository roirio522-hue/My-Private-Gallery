<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Video Store | Rafid Ahammed</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/video.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background-color: #1a1c22; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        
        .circle-wrapper { position: relative; width: 100px; height: 100px; margin: 0 auto; }
        .circle-svg { transform: rotate(-90deg); width: 100px; height: 100px; }
        .circle-bg { fill: none; stroke: #2d3748; stroke-width: 8; }
        .circle-progress { 
            fill: none; stroke: #ef4444; stroke-width: 8; stroke-linecap: round; 
            stroke-dasharray: 283; stroke-dashoffset: 283; 
            transition: stroke-dashoffset 0.4s ease; /* স্মুথ অ্যানিমেশনের জন্য */
        }
        
        .loader { border-top-color: #ef4444; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .video-card { background: #22272e; border: 1px solid #2d333b; border-radius: 20px; transition: 0.3s; overflow: hidden; cursor: pointer; }
        .video-card:hover { border-color: #ef4444; transform: translateY(-5px); }
        
        /* Popup Styles */
        #videoPopup { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; align-items: center; justify-content: center; padding: 15px; }
        .popup-box { background: #1a1c22; width: 100%; max-width: 700px; border-radius: 24px; border: 1px solid #334155; overflow: hidden; }

        #mainContent { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="mainContent">
        <div class="max-w-6xl mx-auto px-4 py-10 w-full text-center relative">
            <a href="index.html" class="fixed left-5 top-5 bg-gray-800 p-3 rounded-xl text-white hover:bg-gray-700 transition-all border border-gray-700">
                <i class="fa-solid fa-arrow-left mr-2"></i> BACK
            </a>

            <header class="mb-10 flex flex-col items-center">
                <img src="https://img.icons8.com/fluency/96/video.png" class="h-16 w-16 mb-2" alt="Video Logo">
                <h1 class="text-3xl md:text-4xl font-black text-white tracking-tighter uppercase">Video Store</h1>
                <p class="text-red-500 font-bold tracking-widest text-[10px] mt-1">SECURE CLOUD VIDEO DRIVE BY RAFID</p>
            </header>

            <div class="max-w-md mx-auto mb-12">
                <div class="bg-[#2d333b] shadow-2xl rounded-3xl p-8 border border-gray-700">
                    <input type="file" id="fileInput" class="hidden" accept="video/*" multiple>
                    <button onclick="document.getElementById('fileInput').click()" id="uploadBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-3 transition-all">
                        <i class="fa-solid fa-clapperboard text-xl"></i> SELECT VIDEO FILES
                    </button>

                    <div id="progressUI" class="hidden mt-8 flex flex-col items-center">
                        <div class="circle-wrapper">
                            <svg class="circle-svg" viewBox="0 0 100 100">
                                <circle class="circle-bg" cx="50" cy="50" r="45"></circle>
                                <circle id="circleBar" class="circle-progress" cx="50" cy="50" r="45"></circle>
                            </svg>
                            <div id="percentValue" class="absolute inset-0 flex items-center justify-center font-black text-xl text-white">0%</div>
                        </div>
                        <p id="statusText" class="mt-4 text-[10px] font-black text-red-500 uppercase tracking-widest italic">UPLOADING VIDEO...</p>
                    </div>
                </div>
            </div>

            <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8"></div>
            <div id="loading" class="py-20"><div class="inline-block loader rounded-full border-4 border-gray-700 h-10 w-10"></div></div>
        </div>

        <footer class="py-10 text-center border-t border-gray-800 bg-[#161b22] mt-auto">
            <p class="text-gray-400 font-bold text-[10px] tracking-widest uppercase">© 2026 Ultimate Video Store | Rafid Ahammed</p>
        </footer>
    </div>

    <div id="videoPopup">
        <div class="popup-box relative">
            <button onclick="closePopup()" class="absolute top-3 right-4 text-white text-2xl z-50"><i class="fa-solid fa-xmark"></i></button>
            <div class="aspect-video bg-black">
                <iframe id="player" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
            </div>
            <div class="p-6 text-center">
                <p id="videoTitle" class="text-gray-400 text-[10px] font-bold uppercase mb-4 truncate"></p>
                <a id="dlBtn" href="#" target="_blank" class="block w-full bg-red-600 hover:bg-red-700 text-white py-4 rounded-xl font-black text-[12px] tracking-[3px] uppercase transition-all">
                    DOWNLOAD DOWNLOAD DOWNLOAD
                </a>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxT5U82y3J6TSgCpNzw_CwRCnA3osqYbn49ae0j5GAwMQboxDRHMBnXyXj-zzY9dqAY/exec";

        window.onload = function() {
            if (localStorage.getItem('gallery_access') === 'true') {
                document.getElementById('mainContent').style.display = 'block';
                loadVideos();
            } else { window.location.href = "index.html"; }
        };

        async function loadVideos() {
            const gallery = document.getElementById('gallery');
            const loader = document.getElementById('loading');
            gallery.innerHTML = '';
            loader.classList.remove('hidden');
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                loader.classList.add('hidden');
                data.forEach(file => {
                    const card = document.createElement('div');
                    card.className = "video-card group";
                    card.onclick = () => openPopup(file.id, file.name);
                    card.innerHTML = `
                        <div class="h-40 md:h-48 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                            <img src="https://lh3.googleusercontent.com/u/0/d/${file.id}=w400-h400-p-k-nu-iv1" 
                                 class="w-full h-full object-cover opacity-60" 
                                 onerror="this.style.display='none'">
                            <i class="fa-solid fa-circle-play text-white/80 text-5xl absolute group-hover:text-red-500 transition-colors"></i>
                        </div>
                        <div class="p-4 bg-[#22272e]">
                            <p class="text-[9px] font-bold text-gray-400 truncate uppercase tracking-wider">${file.name}</p>
                        </div>
                    `;
                    gallery.appendChild(card);
                });
            } catch (error) { loader.classList.add('hidden'); }
        }

        function openPopup(id, name) {
            document.getElementById('player').src = `https://drive.google.com/file/d/${id}/preview`;
            document.getElementById('dlBtn').href = `https://drive.google.com/uc?export=download&id=${id}`;
            document.getElementById('videoTitle').innerText = name;
            document.getElementById('videoPopup').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('player').src = "";
            document.getElementById('videoPopup').style.display = 'none';
        }

        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            const ui = document.getElementById('progressUI');
            const bar = document.getElementById('circleBar');
            const val = document.getElementById('percentValue');
            const status = document.getElementById('statusText');
            const btn = document.getElementById('uploadBtn');
            ui.classList.remove('hidden'); btn.disabled = true;

            for (let i = 0; i < files.length; i++) {
                status.innerText = `UPLOADING VIDEO ${i + 1}/${files.length}`;
                
                // স্মুথ অ্যানিমেশনের জন্য uploadWithProgress কল করা হয়েছে
                await uploadWithProgress(files[i], (percent) => {
                    let totalProg = ((i / files.length) * 100) + (percent / files.length);
                    bar.style.strokeDashoffset = 283 - (283 * totalProg) / 100;
                    val.innerText = Math.round(totalProg) + "%";
                });
            }
            
            status.innerText = "UPLOAD FINISHED ✔";
            setTimeout(() => { ui.classList.add('hidden'); btn.disabled = false; loadVideos(); }, 2000);
        });

        function uploadWithProgress(file, onProgress) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function() {
                    const base64 = reader.result.split(',')[1];
                    
                    let p = 0;
                    let interval = setInterval(() => {
                        p += 2;
                        if (p <= 90) onProgress(p);
                        if (p >= 90) clearInterval(interval);
                    }, 50);

                    fetch(SCRIPT_URL, { 
                        method: "POST", 
                        body: JSON.stringify({ base64: base64, mimetype: file.type, filename: file.name }) 
                    })
                    .then(res => res.json())
                    .then(res => {
                        onProgress(100);
                        resolve(res);
                    })
                    .catch(() => {
                        onProgress(100);
                        resolve();
                    });
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>

